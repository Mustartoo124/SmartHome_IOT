<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Log In & Sign Up</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
      background-color: #2c2f33;
    }
    .container {
      background-color: #23272a;
      border-radius: 10px;
      padding: 40px;
      width: 300px;
      max-width: 100%;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.5);
      color: white;
    }
    h2 {
      text-align: center;
      margin-bottom: 20px;
    }
    .form-group {
      margin-bottom: 15px;
    }
    .form-group label {
      display: block;
      margin-bottom: 5px;
    }
    .form-group input {
      width: calc(100% - 20px); 
      padding: 10px;
      border:none;
      border-radius: 5px;
      background-color: #2c2f33;
    }
    .form-group input::placeholder {
      color: #888;
    }
    .form-group button {
      width: 100%;
      padding: 10px;
      background-color: #4CAF50;
      border: none;
      border-radius: 5px;
      color: white;
      font-size: 16px;
    }
    .form-group button:hover {
      background-color: #45a049;
    }
    .toggle-link {
      display: block;
      margin-top: 15px;
      text-align: center;
      color: #007bff;
      cursor: pointer;
    }
    .toggle-link:hover {
      text-decoration: underline;
    }
    .hidden-form {
      display: none;
    }
    .modal {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background-color: white;
  padding: 20px;
  border-radius: 10px;
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
  text-align: center;
  z-index: 1000;
}

.modal button {
  margin-top: 15px;
  padding: 10px;
  border: none;
  background-color: #4CAF50;
  color: white;
  border-radius: 5px;
  cursor: pointer;
}

.modal button:hover {
  background-color: #45a049;
}

  </style>
</head>
<body>
  <div class="container">
    <form id="loginForm" method="POST" action="/login">
      <h2>Sign In</h2>
      <div class="form-group">
        <label for="loginUsername">Username</label>
        <input type="text" id="loginUsername" name="username" placeholder="Enter your username" required> 
      </div>
      <div class="form-group">
        <label for="loginPassword">Password</label>
        <input type="password" id="loginPassword" name="password" placeholder="Enter your password" required> 
      </div>
      <div class="form-group">
        <button type="submit">Sign In</button>
      </div>
      <p class="toggle-link" onclick="toggleForms()">Don't have an account? Sign Up</p>
    </form>
    

    <form id="signupForm" class="hidden-form" method="POST" action="/signup">
      <h2>Sign Up</h2>
      <div class="form-group">
        <label for="signupName">Full Name</label>
        <input type="text" id="signupName" name="username" placeholder="Enter your full name" required>
      </div>
      <div class="form-group">
        <label for="signupEmail">Email</label>
        <input type="email" id="signupEmail" name="email" placeholder="Enter your email" required>
      </div>
      <div class="form-group">
        <label for="signupPassword">Password</label>
        <input type="password" id="signupPassword" name="password" placeholder="Enter your password" required>
      </div>
      <div class="form-group">
        <button type="submit">Sign Up</button>
      </div>
      <p class="toggle-link" onclick="toggleForms()">Already have an account? Log In</p>
    </form>
    
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      // Chuyển hướng tới trang login khi lần đầu truy cập
      const loginForm = document.getElementById("loginForm");
      const signupForm = document.getElementById("signupForm");
  
      // Hiển thị form login khi tải trang lần đầu
      loginForm.style.display = "block";
      signupForm.style.display = "none";
    });
  
    // Hàm chuyển đổi giữa login và signup
    function toggleForms() {
      const loginForm = document.getElementById('loginForm');
      const signupForm = document.getElementById('signupForm');
      if (loginForm.style.display === 'none') {
        loginForm.style.display = 'block';
        signupForm.style.display = 'none';
      } else {
        loginForm.style.display = 'none';
        signupForm.style.display = 'block';
      }
    }
  
    // Hàm xử lý đăng ký
    document.getElementById("signupForm").addEventListener("submit", async (event) => {
      event.preventDefault(); 
  
      const form = event.target;
      const formData = new FormData(form);
      const data = Object.fromEntries(formData.entries());
  
      try {
        const response = await fetch("http://localhost:3000/signup", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data),
        });
  
        const result = await response.json();
  
        if (response.ok) {
          // Đăng ký thành công, hiển thị form login
          loginForm.style.display = 'block';
          signupForm.style.display = 'none';
        } else {
          showError(result.error || "An unknown error occurred");
        }
      } catch (error) {
        console.error("Error during signup:", error);
        showError("A network error occurred. Please try again later.");
      }
    });
  
    // Hàm xử lý đăng nhập
    document.getElementById("loginForm").addEventListener("submit", async (event) => {
      event.preventDefault(); 
  
      const form = event.target;
      const formData = new FormData(form);
      const data = Object.fromEntries(formData.entries());
  
      try {
        const response = await fetch("http://localhost:3000/login", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data),
        });
  
        const result = await response.json();
  
        if (response.ok) {
          // Đăng nhập thành công, chuyển hướng tới index.html
          localStorage.setItem("username", data.username);
          window.location.href = './index.html';
        } else {
          showError(result.error || "Login failed.");
        }
      } catch (error) {
        console.error("Error during login:", error);
        showError("A network error occurred. Please try again later.");
      }
    });
  
    // Hàm hiển thị lỗi
    function showError(message) {
      const modal = document.createElement("div");
      modal.style.position = "fixed";
      modal.style.top = "50%";
      modal.style.left = "50%";
      modal.style.transform = "translate(-50%, -50%)";
      modal.style.backgroundColor = "#fff";
      modal.style.padding = "20px";
      modal.style.boxShadow = "0 0 10px rgba(0, 0, 0, 0.5)";
      modal.style.borderRadius = "5px";
      modal.style.textAlign = "center";
      modal.style.zIndex = "1000";
  
      const messageText = document.createElement("p");
      messageText.textContent = message;
      modal.appendChild(messageText);
  
      const closeButton = document.createElement("button");
      closeButton.textContent = "OK";
      closeButton.style.marginTop = "10px";
      closeButton.style.padding = "10px";
      closeButton.style.border = "none";
      closeButton.style.backgroundColor = "#4CAF50";
      closeButton.style.color = "white";
      closeButton.style.borderRadius = "5px";
      closeButton.style.cursor = "pointer";
  
      closeButton.onclick = () => {
        document.body.removeChild(modal);
      };
  
      modal.appendChild(closeButton);
      document.body.appendChild(modal);
    }
  </script>
  
</body>
</html>